<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Practice Excel tasks with AI grading in the Dream Centre Proficiency Portal.">
    <title>Excel Practice | Dream Centre</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="stylesheet" href="css/main.css" />
    <script src="/auth.js" defer></script>
</head>

<body class="dashboard-page">
    <header class="test-header">
        <div class="logo">Excel <span>Practice Zone</span></div>
        <a href="/dashboard.html" class="nav-button secondary">Exit Practice</a>
    </header>

    <main class="practice-wrapper">
        <!-- TEST VIEW -->
        <div id="test-view">
            <div class="practice-header">
                <h2>ğŸ“Š Excel Practical Practice</h2>
                <div class="practice-timer">
                    <label for="timer-select" style="margin-right: 8px; font-size: 0.875rem;">Time Limit:</label>
                    <select id="timer-select" style="padding: 4px 8px; border-radius: 4px; margin-right: 12px;">
                        <option value="180">3 min</option>
                        <option value="300">5 min</option>
                        <option value="420" selected>7 min</option>
                        <option value="600">10 min</option>
                        <option value="900">15 min</option>
                        <option value="0">No Limit</option>
                    </select>
                    <span>Time:</span> <span id="timer">07:00</span>
                </div>
            </div>

            <div class="card instructions-card" style="margin-bottom: 1.5rem;">
                <h3 id="question-name">Loading question...</h3>
                <p>1. Click the link below to download the Excel exercise file.</p>
                <p>2. Complete all tasks described in the file's "Instructions" sheet.</p>
                <p>3. Save your completed file and upload it below.</p>
                <a href="#" id="download-btn" class="btn btn-secondary" style="margin-top: 1rem;" download disabled>ğŸ“¥
                    Download Question File</a>
            </div>

            <!-- Hint System -->
            <div id="hint-area" class="card" style="margin-top: 1rem; display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>ğŸ’¡ Hints</h3>
                    <span id="hint-penalty-label" style="font-size: 0.85rem; color: var(--text-muted);">Each hint costs -1 point</span>
                </div>
                <div id="hints-revealed"></div>
                <button id="get-hint-btn" class="btn btn-outline" style="margin-top: 0.75rem;">Get a Hint</button>
            </div>

            <div class="card upload-card">
                <h3>Upload Your Solution</h3>
                <form id="excel-form" class="upload-form"
                    style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                    <input type="file" id="excel-file" name="excelFile" accept=".xlsx,.xls" required class="form-input"
                        style="flex: 1; min-width: 200px;" />
                    <button type="submit" class="btn btn-primary">Submit for AI Grading</button>
                </form>
            </div>
        </div>

        <!-- RESULTS VIEW -->
        <div id="results-view" class="results-view" style="display: none;">
            <div class="score-hero">
                <h2 id="results-title">Your Practice Score</h2>
                <div class="score-ring" id="score-ring">
                    <span class="score-value" id="score-value">0</span>
                </div>
                <p class="score-label" id="score-label">out of 20</p>
                <p id="hint-penalty-result" style="font-size: 0.85rem; color: var(--danger); display: none;"></p>
            </div>

            <div class="card feedback-card" style="margin-bottom: 2rem;">
                <h3>ğŸ“ Point-by-Point Feedback</h3>
                <div id="feedback-content" style="white-space: pre-wrap; line-height: 1.8;"></div>
            </div>

            <div class="action-buttons" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-secondary" id="analyze-btn">ğŸ” Get Detailed AI Analysis</button>
                <button id="solution-steps-btn" class="btn btn-outline" style="display:none;">ğŸ“‹ View Solution Steps</button>
                <button onclick="location.reload()" class="btn btn-outline">ğŸ”„ Try Again</button>
                <button onclick="location.href='/dashboard.html'" class="btn btn-outline">ğŸ  Dashboard</button>
            </div>

            <div id="solution-steps-panel" class="analysis-panel">
                <h3>ğŸ“‹ Solution Steps</h3>
                <ol id="solution-steps-list" style="padding-left: 1.5rem; line-height: 2;"></ol>
            </div>

            <div id="analysis-panel" class="analysis-panel">
                <h3>ğŸ¤– Detailed AI Analysis</h3>
                <div id="analysis-content"></div>
            </div>
        </div>
    </main>

    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>AI is grading your Excel submission...</p>
    </div>

    <script src="toast.js"></script>
    <script type="module" src="/js/pages/practice-excel.js"></script>
    </body>

</html>