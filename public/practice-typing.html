<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Practice your typing speed and accuracy with AI coaching in the Dream Centre Proficiency Portal.">
    <title>Typing Practice | Dream Centre</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="stylesheet" href="css/main.css">
    <script src="/auth.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body class="practice-page">
    <header class="practice-header">
        <div class="practice-header-inner">
            <div class="logo">Typing <span>Practice Zone</span></div>
            <a href="/dashboard.html" class="nav-button secondary">Exit Practice</a>
        </div>
    </header>

    <main class="practice-container">
        <!-- CONFIG VIEW -->
        <div id="config-view" class="practice-config-card">
            <div class="config-header">
                <h1>‚å®Ô∏è Typing Practice</h1>
                <p>Configure your session and improve your skills</p>
            </div>

            <div class="config-grid">
                <div class="config-section">
                    <label>Test Mode</label>
                    <div class="selector-grid">
                        <button class="select-btn active" data-testmode="time">‚è± Timed</button>
                        <button class="select-btn" data-testmode="words">üî¢ Word Count</button>
                    </div>
                </div>

                <div class="config-section" id="duration-section">
                    <label>Test Duration</label>
                    <div class="selector-grid">
                        <button class="select-btn" data-time="60">1 Minute</button>
                        <button class="select-btn active" data-time="120">2 Minutes</button>
                        <button class="select-btn" data-time="300">5 Minutes</button>
                    </div>
                </div>

                <div class="config-section hidden" id="wordcount-section">
                    <label>Word Count</label>
                    <div class="selector-grid">
                        <button class="select-btn active" data-words="25">25 Words</button>
                        <button class="select-btn" data-words="50">50 Words</button>
                        <button class="select-btn" data-words="100">100 Words</button>
                    </div>
                </div>

                <div class="config-section">
                    <label>Passage Difficulty</label>
                    <div class="selector-grid">
                        <button class="select-btn active" data-diff="easy">Easy</button>
                        <button class="select-btn" data-diff="medium">Medium</button>
                        <button class="select-btn" data-diff="hard">Hard</button>
                    </div>
                </div>
            </div>

            <div class="mode-selector">
                <button class="mode-btn active" data-mode="standard">
                    <span class="mode-icon">üëÅÔ∏è</span>
                    <div class="mode-content">
                        <span class="mode-label">Standard</span>
                        <span class="mode-desc">Visual feedback & stats</span>
                    </div>
                </button>
                <button class="mode-btn" data-mode="simulation">
                    <span class="mode-icon">üéØ</span>
                    <div class="mode-content">
                        <span class="mode-label">Simulation</span>
                        <span class="mode-desc">Exam-like minimal UI</span>
                    </div>
                </button>
            </div>

            <button class="primary start-btn" onclick="launchPractice()">
                üöÄ Launch Practice
            </button>

            <hr class="practice-divider">

            <div class="drills-section">
                <h3>üèãÔ∏è Finger Drill Practice</h3>
                <div class="drill-grid">
                    <button class="drill-btn" data-drill="home">
                        <span class="drill-icon">üè†</span>
                        <span>Home Row</span>
                    </button>
                    <button class="drill-btn" data-drill="top">
                        <span class="drill-icon">‚¨ÜÔ∏è</span>
                        <span>Top Row</span>
                    </button>
                    <button class="drill-btn" data-drill="bottom">
                        <span class="drill-icon">‚¨áÔ∏è</span>
                        <span>Bottom Row</span>
                    </button>
                    <button class="drill-btn" data-drill="numbers">
                        <span class="drill-icon">üî¢</span>
                        <span>Numbers</span>
                    </button>
                    <button class="drill-btn" data-drill="words">
                        <span class="drill-icon">üìù</span>
                        <span>Words</span>
                    </button>
                    <button class="drill-btn" data-drill="punctuation">
                        <span class="drill-icon">.,!</span>
                        <span>Punctuation</span>
                    </button>
                    <button class="drill-btn" data-drill="symbols">
                        <span class="drill-icon">@#$</span>
                        <span>Symbols</span>
                    </button>
                    <button class="drill-btn" data-drill="custom">
                        <span class="drill-icon">‚úèÔ∏è</span>
                        <span>Custom</span>
                    </button>
                </div>
                <div id="word-set-picker" class="word-set-picker">
                    <button class="word-set-btn active" data-set="1k">1K Words</button>
                    <button class="word-set-btn" data-set="5k">5K Words</button>
                    <button class="word-set-btn" data-set="10k">10K Words</button>
                </div>
                <textarea id="drill-custom-text" class="drill-custom-input hidden" rows="3"
                    placeholder="Type your custom drill text here..."></textarea>
                <button class="primary start-btn drill-start-btn" onclick="launchDrill()">
                    Start Finger Drill
                </button>
            </div>
        </div>

        <!-- DECORATED ENGINE -->
        <div id="decorated-engine" class="practice-engine hidden">
            <div class="engine-card">
                <div class="engine-header">
                    <div class="engine-stats-bar">
                        <div class="engine-stat">
                            <span class="engine-stat-value" id="dec-timer">02:00</span>
                            <span class="engine-stat-label">Time</span>
                        </div>
                        <div class="engine-stat">
                            <span class="engine-stat-value" id="dec-wpm">0</span>
                            <span class="engine-stat-label">WPM</span>
                        </div>
                        <div class="engine-stat">
                            <span class="engine-stat-value" id="dec-accuracy">100%</span>
                            <span class="engine-stat-label">Accuracy</span>
                        </div>
                    </div>
                </div>
                <div id="dec-passage" class="passage-display">Loading passage...</div>
                <textarea id="dec-input" class="engine-textarea" placeholder="Start typing here..." autocomplete="off"
                    autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                <div id="dec-admin-bypass" class="admin-bypass hidden">
                    <button class="btn secondary" id="dec-quick-submit">Admin: Quick Submit</button>
                </div>
            </div>
        </div>

        <!-- SIMULATION ENGINE -->
        <div id="sim-engine" class="practice-engine hidden">
            <div class="engine-card simulation-mode win97-mode">
                <div class="win97-window">
                    <div class="win97-titlebar">
                        <span class="win97-titlebar-title">Typing Test - Simulation Mode</span>
                        <div class="win97-titlebar-controls">
                            <span class="win97-titlebar-btn">_</span>
                            <span class="win97-titlebar-btn">‚ñ°</span>
                            <span class="win97-titlebar-btn">√ó</span>
                        </div>
                    </div>
                    <div class="win97-body">
                        <div class="win97-stats-bar">
                            <div class="win97-stat">
                                <span class="win97-stat-label">Time:</span>
                                <span class="win97-stat-value" id="sim-timer">02:00</span>
                            </div>
                            <div class="win97-stat">
                                <span class="win97-stat-label">WPM:</span>
                                <span class="win97-stat-value" id="sim-wpm">0</span>
                            </div>
                        </div>
                        <div class="win97-text-size-controls">
                            <span>Text Size:</span>
                            <button class="win97-text-size-btn" onclick="changePassageSize(-1)">‚àí</button>
                            <button class="win97-text-size-btn" onclick="changePassageSize(1)">+</button>
                        </div>
                        <div class="win97-passage-container" id="sim-passage-container">
                            <div id="sim-passage" class="win97-passage-text">Loading passage...</div>
                        </div>
                        <div class="win97-textarea-container">
                            <textarea id="sim-input" class="win97-textarea" placeholder="Start typing here..." autocomplete="off"
                                autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                        </div>
                        <div id="sim-admin-bypass" class="win97-button-bar hidden">
                            <button class="win97-btn" id="sim-quick-submit">Admin: Quick Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DRILL ENGINE -->
        <div id="drill-engine" class="practice-engine hidden">
            <div class="engine-card">
                <div class="drill-header">
                    <h3 id="drill-title">Finger Drill</h3>
                    <button class="drill-back-btn" onclick="exitDrill()">Back</button>
                </div>
                <div id="drill-progress" class="drill-progress">Rep 1 of 10</div>
                <div id="drill-passage-display" class="drill-passage-display"></div>
                <textarea id="drill-input" class="drill-input" placeholder="Type the text above..." autocomplete="off"
                    autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
                <div class="drill-accuracy-bar">
                    <div id="drill-accuracy-fill" class="drill-accuracy-fill"></div>
                </div>
                <div class="drill-stats">
                    <span>Accuracy: <strong id="drill-acc-text">100%</strong></span>
                    <span>Errors: <strong id="drill-err-text">0</strong></span>
                    <span>WPM: <strong id="drill-wpm-text">0</strong></span>
                </div>
                <div id="drill-complete" class="drill-complete-card hidden">
                    <h3>Drill Complete!</h3>
                    <p id="drill-complete-msg"></p>
                    <p id="drill-record-msg" class="drill-record-msg hidden"></p>
                    <div class="drill-complete-actions">
                        <button onclick="restartDrill()" class="drill-action-btn primary">Repeat</button>
                        <button id="drill-back-to-results-btn" onclick="backToResults()" class="drill-action-btn hidden">Back to Results</button>
                        <button onclick="exitDrill()" class="drill-action-btn">Back</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESULTS VIEW -->
        <div id="results-view" class="results-view practice-results-view hidden">
            <!-- Adaptive Difficulty Suggestion Banner -->
            <div id="adaptive-suggestion-banner" class="adaptive-banner hidden"></div>

            <div class="results-header">
                <h2>Practice Complete!</h2>
                <div class="results-tabs">
                    <button class="tab-btn active" onclick="switchResultsTab('overview')">Overview</button>
                    <button class="tab-btn" onclick="switchResultsTab('analysis')">Analysis & Heatmap</button>
                </div>
            </div>

            <!-- OVERVIEW TAB -->
            <div id="tab-overview" class="results-tab-content active">
                <div class="practice-results-card score-card">
                    <div class="practice-score-section">
                        <div class="practice-score-circle" id="score-ring">
                            <span class="score-value" id="score-wpm">0</span>
                            <span class="score-label">WPM</span>
                        </div>
                        <div id="personal-record-badge" class="personal-record-badge hidden">
                            <span>New Personal Record!</span>
                        </div>
                        <div class="practice-stats-row">
                            <div class="practice-stat">
                                <span id="stat-accuracy">0%</span>
                                <label>Accuracy</label>
                            </div>
                            <div class="practice-stat">
                                <span id="stat-chars">0</span>
                                <label>Characters</label>
                            </div>
                            <div class="practice-stat">
                                <span id="stat-errors">0</span>
                                <label>Errors</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="practice-results-card wpm-chart-card">
                    <h3>Speed Over Time</h3>
                    <div class="chart-container">
                        <canvas id="wpm-chart"></canvas>
                    </div>
                </div>

                <div class="ai-coach-section">
                    <button id="analyze-btn" class="ai-coach-btn">
                        <span class="icon">ü§ñ</span>
                        <span class="text">Analyze with AI Coach</span>
                    </button>
                    
                    <!-- Hidden Coach Panel -->
                    <div id="coach-panel" class="coach-panel hidden">
                        <div class="coach-header">
                            <h3>AI Coaching Report</h3>
                            <span class="badge">Personalized</span>
                        </div>
                        <div id="coach-content"></div>
                    </div>
                </div>
            </div>

            <!-- ANALYSIS TAB -->
            <div id="tab-analysis" class="results-tab-content">
                <div class="practice-results-card heatmap-card">
                    <div class="heatmap-header">
                        <h3>Keyboard Heatmap (Error Intensity)</h3>
                    </div>
                    <div id="keyboard-heatmap"></div>
                </div>

                <div class="practice-results-card analysis-card">
                    <h3>Detailed Error Analysis</h3>
                    <div class="analysis-grid">
                        <div class="analysis-section">
                            <h4>Top Mistyped Keys</h4>
                            <div id="top-errors-chart"></div>
                        </div>
                        <div class="analysis-section">
                            <h4>Finger Performance</h4>
                            <div id="finger-stats"></div>
                        </div>
                    </div>
                    <div class="recommendations">
                        <h4>Recommendations</h4>
                        <div id="recommendations-list"></div>
                    </div>
                </div>
                
                <div class="practice-results-card history-card">
                    <h3>Your Progress</h3>
                    <div id="progress-chart"></div>
                </div>
            </div>

            <div class="results-footer">
                <button class="btn secondary" onclick="retryPractice()">Try Again</button>
                <button class="btn secondary" onclick="backToConfig()">New Session</button>
                <button class="btn primary" onclick="location.href='/dashboard.html'">Dashboard</button>
            </div>
        </div>
    </main>

    <script src="toast.js"></script>
    <script src="theme-toggle.js"></script>
    <script type="module" src="/js/pages/practice.js"></script>
</body>

</html>
