<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel | Dream Centre</title>
    <link rel="stylesheet" href="gamified-theme.css">
    <script src="/admin-auth.js" defer></script>
</head>

<body class="admin-page">
    <header class="dashboard-header">
        <div class="logo-area">
            <img src="/logo.png" alt="Logo" class="logo" />
            <h1>Admin Panel</h1>
        </div>
        <nav class="dashboard-nav">
            <a href="/dashboard.html" class="nav-button">Back to Dashboard</a>
            <button id="logout-btn" class="nav-button secondary">Logout</button>
        </nav>
    </header>

    <main class="admin-content">
        <!-- User Management Section -->
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.5rem;">
                <h2>User Management</h2>
                <button id="add-user-btn"
                    style="background:#10b981; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600;">+
                    Add User</button>
            </div>
            <div class="filter-bar" style="margin-top:1rem;">
                <input type="text" id="user-search" placeholder="Search by username or email...">
                <select id="user-role-filter">
                    <option value="">All Roles</option>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Verified</th>
                            <th>Auth</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody"></tbody>
                </table>
            </div>
            <div class="pagination-controls"
                style="display:flex; justify-content:space-between; align-items:center; margin-top:1rem;">
                <button id="users-prev-btn" class="secondary" disabled>Previous</button>
                <span id="users-page-info" style="font-size:0.9rem; color:#64748b;">Page 1</span>
                <button id="users-next-btn" class="secondary" disabled>Next</button>
            </div>
        </div>

        <!-- Add User Modal -->
        <div id="add-user-modal" class="modal-overlay">
            <div class="modal-box">
                <h3>Add New User</h3>
                <label>Username</label>
                <input type="text" id="new-user-username" placeholder="Username" required>
                <label>Email</label>
                <input type="email" id="new-user-email" placeholder="Email" required>
                <label>Password</label>
                <input type="password" id="new-user-password" placeholder="Min 6 characters" required>
                <label>Role</label>
                <select id="new-user-role">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
                <div class="modal-actions">
                    <button class="btn-cancel"
                        onclick="document.getElementById('add-user-modal').classList.remove('active')">Cancel</button>
                    <button class="btn-save" id="save-new-user-btn">Create User</button>
                </div>
            </div>
        </div>

        <!-- Reset Password Modal -->
        <div id="reset-pw-modal" class="modal-overlay">
            <div class="modal-box">
                <h3>Reset Password</h3>
                <p id="reset-pw-user-info" style="font-size:0.9rem; color:#64748b;"></p>
                <input type="hidden" id="reset-pw-user-id">
                <label>New Password</label>
                <input type="password" id="reset-pw-value" placeholder="Min 6 characters" required>
                <div class="modal-actions">
                    <button class="btn-cancel"
                        onclick="document.getElementById('reset-pw-modal').classList.remove('active')">Cancel</button>
                    <button class="btn-save" id="save-reset-pw-btn">Reset Password</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>All User Submissions</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Test Type</th>
                            <th>Score / Details</th>
                            <th>Submitted At</th>
                            <th>Submission</th>
                        </tr>
                    </thead>
                    <tbody id="results-tbody"></tbody>
                </table>
            </div>
        </div>

        <div class="content-management">
            <div class="card">
                <h3>Add New Typing Passage</h3>
                <form id="add-passage-form">
                    <textarea id="passage-content" name="content" rows="4"
                        placeholder="Enter new passage text..."></textarea>
                    <select id="difficulty" name="difficulty">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                    <button type="submit">Add Passage</button>
                </form>
            </div>

            <div class="card">
                <h3>Add New Letter Question</h3>
                <form id="add-question-form">
                    <textarea id="question-text" name="questionText" rows="4"
                        placeholder="Enter new letter question..."></textarea>
                    <select id="question-category" name="category">
                        <option value="formal" selected>Formal</option>
                        <option value="business">Business</option>
                    </select>
                    <button type="submit">Add Question</button>
                </form>
            </div>

            <div class="card">
                <h3>Add New Excel Question (Practical)</h3>
                <form id="add-excel-form" enctype="multipart/form-data">
                    <input type="text" id="question-name" name="questionName" placeholder="Question Name" required>
                    <label>Question File (Blank)</label>
                    <input type="file" id="question-file" name="questionFile" required>
                    <label>Solution File (Completed)</label>
                    <input type="file" id="solution-file" name="solutionFile" required>
                    <button type="submit">Add Excel Question</button>
                </form>
            </div>

            <div class="card">
                <h3>Add New Excel MCQ</h3>
                <form id="add-mcq-form">
                    <textarea id="mcq-text" placeholder="Question Text..." required></textarea>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 5px; margin: 10px 0;">
                        <input type="text" id="mcq-opt-0" placeholder="A" required>
                        <input type="text" id="mcq-opt-1" placeholder="B" required>
                        <input type="text" id="mcq-opt-2" placeholder="C" required>
                        <input type="text" id="mcq-opt-3" placeholder="D" required>
                    </div>
                    <label>Correct Index (0-3)</label>
                    <input type="number" id="mcq-correct" min="0" max="3" value="0">
                    <select id="mcq-category">
                        <option value="Formulas">Formulas</option>
                        <option value="Shortcuts">Shortcuts</option>
                        <option value="Basic Operations">Basic Operations</option>
                        <option value="Cell Referencing">Cell Referencing</option>
                        <option value="Formatting">Formatting</option>
                        <option value="Charts">Charts</option>
                        <option value="Pivot Tables">Pivot Tables</option>
                        <option value="Data Validation">Data Validation</option>
                        <option value="Conditional Formatting">Conditional Formatting</option>
                    </select>
                    <select id="mcq-difficulty" style="margin-top:5px;">
                        <option value="Easy">Easy</option>
                        <option value="Medium" selected>Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                    <textarea id="mcq-explanation" placeholder="Explanation (why this answer is correct)..." rows="2"
                        style="margin-top:5px;"></textarea>
                    <label style="margin-top:5px; display:block; font-size:0.8rem; font-weight:600;">Question Image
                        (Optional)</label>
                    <input type="file" id="mcq-image" accept="image/*" style="margin-top:2px;">
                    <button type="submit">Save MCQ</button>
                </form>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>Create 10-Question Mock Set</h3>
                    <span id="mcq-counter" class="counter-pill">Selected: 0/10</span>
                </div>
                <input type="text" id="mcq-set-name" placeholder="Set Name (e.g., Mock Set #01)">

                <!-- Search & Filter -->
                <div class="filter-bar">
                    <input type="text" id="bank-search" placeholder="üîç Search questions...">
                    <select id="bank-filter-category">
                        <option value="">All Categories</option>
                        <option value="Formulas">Formulas</option>
                        <option value="Shortcuts">Shortcuts</option>
                        <option value="Basic Operations">Basic Operations</option>
                        <option value="Cell Referencing">Cell Referencing</option>
                        <option value="Formatting">Formatting</option>
                        <option value="Charts">Charts</option>
                        <option value="Pivot Tables">Pivot Tables</option>
                        <option value="Data Validation">Data Validation</option>
                        <option value="Conditional Formatting">Conditional Formatting</option>
                    </select>
                    <select id="bank-filter-difficulty">
                        <option value="">All Difficulties</option>
                        <option value="Easy">Easy</option>
                        <option value="Medium">Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                </div>

                <!-- Category Counts -->
                <div id="category-counts" class="category-counts"></div>

                <div id="mcq-selection-bank" class="mcq-bank">
                    <p style="color:#666; font-size:0.8rem;">Loading question bank...</p>
                </div>

                <!-- Pagination Controls -->
                <div class="pagination-controls"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                    <button id="prev-page-btn" class="secondary" disabled>Previous</button>
                    <span id="page-info" style="font-size:0.9rem; color:#64748b;">Page 1</span>
                    <button id="next-page-btn" class="secondary" disabled>Next</button>
                </div>

                <div style="display:flex; gap:10px;">
                    <button id="preview-set-btn" class="secondary" style="flex:1;">üëÅÔ∏è Preview Selected</button>
                    <button id="create-set-btn" class="primary" style="flex:2;">Finalize Set</button>
                </div>
            </div>

            <div class="card">
                <h3>Bulk Upload MCQs (CSV)</h3>
                <p style="font-size: 0.8rem; color: #64748b; margin-bottom: 1rem;">
                    Format: questionText, optionA, optionB, optionC, optionD, correctAnswerIndex, category
                </p>
                <form id="bulk-mcq-form">
                    <input type="file" id="csv-file" accept=".csv" required>
                    <button type="submit" class="secondary" style="margin-top: 10px;">Upload Question Bank</button>
                </form>
            </div>

            <!-- Set Management -->
            <div class="card">
                <h3>üìã Manage Mock Sets</h3>
                <div id="sets-list" class="set-list">
                    <p style="color:#666; font-size:0.8rem;">Loading sets...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit MCQ Modal -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal-box">
            <h3>Edit MCQ Question</h3>
            <input type="hidden" id="edit-id">
            <label>Question Text</label>
            <textarea id="edit-text" rows="3"></textarea>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 8px;">
                <div><label>Option A</label><input type="text" id="edit-opt-0"></div>
                <div><label>Option B</label><input type="text" id="edit-opt-1"></div>
                <div><label>Option C</label><input type="text" id="edit-opt-2"></div>
                <div><label>Option D</label><input type="text" id="edit-opt-3"></div>
            </div>
            <label>Correct Index (0-3)</label>
            <input type="number" id="edit-correct" min="0" max="3">
            <label>Category</label>
            <select id="edit-category">
                <option value="Formulas">Formulas</option>
                <option value="Shortcuts">Shortcuts</option>
                <option value="Basic Operations">Basic Operations</option>
                <option value="Cell Referencing">Cell Referencing</option>
                <option value="Formatting">Formatting</option>
                <option value="Charts">Charts</option>
                <option value="Pivot Tables">Pivot Tables</option>
                <option value="Data Validation">Data Validation</option>
                <option value="Conditional Formatting">Conditional Formatting</option>
            </select>
            <label>Difficulty</label>
            <select id="edit-difficulty">
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
            </select>
            <label>Explanation</label>
            <textarea id="edit-explanation" rows="2"></textarea>
            <label>Update Image (Optional)</label>
            <input type="file" id="edit-image" accept="image/*">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="btn-save" onclick="saveEditMCQ()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Preview Set Modal -->
    <div id="preview-modal" class="modal-overlay">
        <div class="modal-box" style="max-width: 700px;">
            <h3>Preview Selected Questions</h3>
            <div id="preview-content"
                style="max-height: 60vh; overflow-y: auto; background:#f8fafc; padding:1rem; border-radius:8px; border:1px solid #e2e8f0;">
                <!-- Content injected via JS -->
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closePreviewModal()">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="/js/pages/admin/main.js"></script>
    <script src="theme-toggle.js"></script>
</body>

</html>